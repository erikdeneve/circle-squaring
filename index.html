<html>
<title>Circle-Squaring</title>
<head>
<meta charset="UTF-8">
<style>
* { margin:0; padding:0; } /* to remove the top and left whitespace */
html, body { width:100%; height:100%; } /* just to be sure these are full screen*/
canvas { display:block; } /* To remove the scrollbars */
</style>
</head>
<body>
<canvas id="myCanvas"></canvas> 
<script>
// ======================================
// Point2D class
function Point2D( x, y ) {
    this.x = x;
    this.y = y;
};
Point2D.prototype.getAsString = function() {
    return this.x + "," + this.y;
}
// ======================================
// Polygon class
function Polygon() {
    this.points = new Array(); // a list of Point2D's
};
Polygon.prototype.drawPath = function( ctx ) {
    ctx.beginPath();
    ctx.moveTo( this.points[0].x, this.points[0].y );
    for( var i = 1; i < this.points.length; ++i )
        ctx.lineTo( this.points[i].x, this.points[i].y );
    ctx.closePath();
};
function getCircle( center, radius, n )
{
    var poly = new Polygon();
    for( var i = 0; i < n; ++i )
    {
        poly.points[i] = new Point2D( center.x + radius * Math.cos( i * 2.0 * Math.PI / n ), 
                                      center.y + radius * Math.sin( i * 2.0 * Math.PI / n ) );
    }
    return poly;
};
Polygon.prototype.getAsString = function() {
    var spec = this.points.length;
    for( var i = 0; i < this.points.length; ++i )
        spec += "," + this.points[i].getAsString();
    return spec;
}
// ======================================
// Transform class
function Transform( r, p ) {
    this.rotate = r;
    this.translate = p;
};
Transform.prototype.getAsString = function() {
    return this.rotate + "," + this.translate.getAsString();
}
// ======================================
// Piece class
function Piece() {
    this.atOrigin = new Polygon();              // canonical polygon with centroid at the origin
    this.originToTarget = new Array();          // a Transform for each target
    this.hue = Math.random() * 360.0;
};
Piece.prototype.draw = function( ctx ) {
    ctx.fillStyle = "hsla("+this.hue+",50%,50%,0.3)";
    for(var i = 0; i < this.originToTarget.length; ++i ) {
        ctx.save();
        ctx.translate( this.originToTarget[i].translate.x, this.originToTarget[i].translate.y );
        ctx.rotate( this.originToTarget[i].rotate );
        this.atOrigin.drawPath( ctx );
        ctx.fill();
        ctx.restore();
    }
};
Piece.prototype.getAsString = function() {
    var spec = this.atOrigin.getAsString() + "," + this.originToTarget.length + "," + this.hue;
    for( var i = 0; i < this.originToTarget.length; ++i )
        spec += "," + this.originToTarget[i].getAsString();
    return spec;
}
// ======================================
// World class
function World() {
    this.circleCenter = new Point2D( 250, 350 );
    this.circleRadius = 200.0;
    
    this.squareCenter = new Point2D( 650, 350 );
    this.squareRadius = this.circleRadius * Math.sqrt( Math.PI ) / 2.0;

    this.targets = new Array();
    this.targets[0] = getCircle( this.circleCenter, this.circleRadius, 100 );
    this.targets[1] = new Polygon();
    this.targets[1].points[0] = new Point2D( this.squareCenter.x - this.squareRadius, this.squareCenter.y - this.squareRadius );
    this.targets[1].points[1] = new Point2D( this.squareCenter.x - this.squareRadius, this.squareCenter.y + this.squareRadius );
    this.targets[1].points[2] = new Point2D( this.squareCenter.x + this.squareRadius, this.squareCenter.y + this.squareRadius );
    this.targets[1].points[3] = new Point2D( this.squareCenter.x + this.squareRadius, this.squareCenter.y - this.squareRadius );

    this.pieces = new Array();
    
    var test = this.pieces[0] = new Piece();
    test.atOrigin.points[0] = new Point2D( -10, -10 );
    test.atOrigin.points[1] = new Point2D( 34, 10 );
    test.atOrigin.points[2] = new Point2D( 7, 20 );
    test.originToTarget[0] = new Transform( 0.3, this.circleCenter );
    test.originToTarget[1] = new Transform( 0.6, this.squareCenter );
    
    var test2 = this.pieces[1] = new Piece();
    test2.atOrigin.points[0] = new Point2D( -10, -10 );
    test2.atOrigin.points[1] = new Point2D( 34, 10 );
    test2.atOrigin.points[2] = new Point2D( 7, 20 );
    test2.atOrigin.points[3] = new Point2D( -17, 30 );
    test2.originToTarget[0] = new Transform( 0.7, new Point2D( this.circleCenter.x - 50.0, this.circleCenter.y - 50.0 ) );
    test2.originToTarget[1] = new Transform( 0.8, new Point2D( this.squareCenter.x + 50.0, this.squareCenter.y - 50.0 ) );
};
World.prototype.draw = function( canvas, context ) {
    // draw the background
    context.fillStyle = "rgb(200,200,200)";
    context.beginPath();
    context.fillRect( 0, 0, canvas.width, canvas.height );
    context.closePath();
    
    // draw the targets
    context.fillStyle = "rgb(255,255,255)";
    for( var i = 0; i < this.targets.length; ++i )
    {
        this.targets[i].drawPath( context );
        context.fill();
    }
        
    // draw the pieces
    for( var i = 0; i < this.pieces.length; ++i )
    {
        this.pieces[i].draw( context );
    }
    
    // DEBUG: draw the spec string
    context.fillStyle = "rgb(0,0,0)";
    context.font="12px Arial";
    context.fillText( this.getAsString(), 10, 50 );
};
World.prototype.getAsString = function() {
    // targets:
    var spec = this.targets.length + "," + this.circleCenter.getAsString() + "," + this.circleRadius + ","
                + this.squareCenter.getAsString() + "," + this.squareRadius;
                
    // pieces:
    spec += "," + this.pieces.length;
    for( var i = 0; i < this.pieces.length; ++i )
        spec += "," + this.pieces[i].getAsString();
    return spec;
};
// ======================================

(function() 
{
    var canvas = document.getElementById('myCanvas'),
    context = canvas.getContext('2d');
    
    var world = new World();

    // resize the canvas to fill browser window dynamically
    window.addEventListener('resize', resizeCanvas, false);

    function resizeCanvas() 
    {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        /**
        * Your drawings need to be inside this function otherwise they will be reset when 
        * you resize the browser window and the canvas goes will be cleared.
        */
        world.draw( canvas, context ); 
    }
    resizeCanvas();

    window.requestAnimFrame = (function(callback) 
    {
        return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
            function(callback) {
                window.setTimeout(callback, 1000 / 60);
            };
    })();

    function animate() 
    {
        var canvas = document.getElementById('myCanvas');
        var context = canvas.getContext('2d');

        // draw stuff
        world.draw( canvas, context );

        // request new frame
        requestAnimFrame(function() {
            animate();
        });
    }
    animate();
    
})();
</script> 
</body>
</html>
